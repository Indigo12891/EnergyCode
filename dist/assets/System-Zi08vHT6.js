import{G as $,d as M,u as H,s as I,j as b,c as P,a as t,r as o,f as e,g as w,k as p,o as D,E as q,b as J,i,F as Q,w as W,A as X,t as R}from"./index-CQiJAfLM.js";import{u as Y}from"./useHttp-BK1GHVdS.js";function j(m){return m.map(s=>{const r={label:s.name,url:s.url};return s.children&&(r.children=j(s.children)),r})}function Z(m){return $("/userAuth",{pageAuthority:m})}function ee(m,s,r){return $("/setAuth",{account:m,btnList:s,pageList:r})}const te={class:"dialog-footer"},le=M({__name:"AuthModal",props:{visible:{type:Boolean},checkedKeys:{},btnAuth:{},account:{}},emits:["close","reload"],setup(m,{emit:s}){const r=m,V=H(),{menu:S}=I(V),g=s,U=b(j(S.value)),_=b(),h=b([]),B=()=>{console.log(r.checkedKeys),_.value.setCheckedKeys(r.checkedKeys),h.value=r.btnAuth},C=()=>{g("close")},K=async()=>{const f=await ee(r.account,_.value.getCheckedKeys(!0),h.value);f.code==200&&(q({message:f.message,type:"success"}),g("close"),g("reload"))};return(f,u)=>{const x=o("el-tree"),z=o("el-card"),y=o("el-checkbox"),k=o("el-checkbox-group"),l=o("el-button"),v=o("el-dialog");return D(),P(v,{title:"权限设置",width:"600px","model-value":f.visible,onOpen:B,onClose:C},{footer:t(()=>[w("div",te,[e(l,{onClick:u[1]||(u[1]=n=>f.$emit("close"))},{default:t(()=>u[4]||(u[4]=[p("取消")])),_:1}),e(l,{type:"primary",onClick:K},{default:t(()=>u[5]||(u[5]=[p(" 确认 ")])),_:1})])]),default:t(()=>[e(z,null,{header:t(()=>u[2]||(u[2]=[w("div",{class:"card-header"},[w("span",null,"页面权限")],-1)])),default:t(()=>[e(x,{ref_key:"treeRef",ref:_,style:{"max-width":"600px"},"show-checkbox":"",data:U.value,"node-key":"url"},null,8,["data"])]),_:1}),e(z,{class:"mt"},{header:t(()=>u[3]||(u[3]=[w("div",{class:"card-header"},[w("span",null,"按钮权限")],-1)])),default:t(()=>[e(k,{modelValue:h.value,"onUpdate:modelValue":u[0]||(u[0]=n=>h.value=n),class:"mt"},{default:t(()=>[e(y,{label:"全部",value:"all"}),e(y,{label:"添加",value:"add"}),e(y,{label:"编辑",value:"edit"}),e(y,{label:"删除",value:"delete"})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model-value"])}}}),se=M({__name:"System",setup(m){const s=b({name:"",department:""}),{dataList:r,loading:V,resetPagination:S,loadData:g,totals:U,pageInfo:_,handleCurrentChange:h,handleSizeChange:B}=Y("/permissionList",s),C=b(!1);function K(k){const l=[];function v(n){n.url&&!n.children&&l.push(n.url),n.children&&n.children.forEach(c=>v(c))}return k.forEach(n=>v(n)),l}const f=b([]),u=b([]),x=b(""),z=async(k,l)=>{x.value=l;const{data:{list:v,btn:n}}=await Z(k);f.value=K(v),u.value=n,C.value=!0},y=()=>{s.value={name:"",department:""},S()};return(k,l)=>{const v=o("el-input"),n=o("el-col"),c=o("el-option"),F=o("el-select"),A=o("el-button"),L=o("el-row"),E=o("el-card"),d=o("el-table-column"),N=o("el-tag"),O=o("el-table"),T=o("el-pagination"),G=X("loading");return D(),J(Q,null,[e(E,null,{default:t(()=>[e(L,{gutter:20},{default:t(()=>[e(n,{span:6},{default:t(()=>[e(v,{modelValue:s.value.name,"onUpdate:modelValue":l[0]||(l[0]=a=>s.value.name=a),modelModifiers:{trim:!0},placeholder:"请输入姓名"},null,8,["modelValue"])]),_:1}),e(n,{span:6},{default:t(()=>[e(F,{placeholder:"请选择部门",modelValue:s.value.department,"onUpdate:modelValue":l[1]||(l[1]=a=>s.value.department=a)},{default:t(()=>[e(c,{label:"全部",value:""}),e(c,{label:"总裁办",value:"总裁办"}),e(c,{label:"技术部",value:"技术部"}),e(c,{label:"市场部",value:"市场部"}),e(c,{label:"维修部",value:"维修部"}),e(c,{label:"运营部",value:"运营部"}),e(c,{label:"客服部",value:"客服部"})]),_:1},8,["modelValue"])]),_:1}),e(n,{span:6},{default:t(()=>[e(A,{type:"primary",onClick:i(g)},{default:t(()=>l[5]||(l[5]=[p("查询")])),_:1},8,["onClick"]),e(A,{onClick:y},{default:t(()=>l[6]||(l[6]=[p("重置")])),_:1})]),_:1})]),_:1})]),_:1}),e(E,{class:"mt"},{default:t(()=>[W((D(),P(O,{data:i(r)},{default:t(()=>[e(d,{type:"index",label:"序号",width:"80"}),e(d,{prop:"account",label:"账号"}),e(d,{prop:"name",label:"姓名"}),e(d,{prop:"phone",label:"电话"}),e(d,{prop:"idNo",label:"身份证号"}),e(d,{prop:"position",label:"职位"},{default:t(a=>[e(N,{type:"primary"},{default:t(()=>[p(R(a.row.position),1)]),_:2},1024)]),_:1}),e(d,{prop:"department",label:"部门"}),e(d,{prop:"pageAuthority",label:"页面权限"},{default:t(a=>[e(N,{type:"success"},{default:t(()=>[p(R(a.row.pageAuthority),1)]),_:2},1024)]),_:1}),e(d,{prop:"btnAuthority",label:"按钮权限"},{default:t(a=>[e(N,{type:"info"},{default:t(()=>[p(R(a.row.btnAuthority),1)]),_:2},1024)]),_:1}),e(d,{label:"操作",width:"280"},{default:t(a=>[e(A,{type:"primary",size:"small",onClick:ae=>z(a.row.pageAuthority,a.row.account)},{default:t(()=>l[7]||(l[7]=[p(" 权限设置 ")])),_:2},1032,["onClick"]),e(A,{type:"danger",size:"small"},{default:t(()=>l[8]||(l[8]=[p(" 删除 ")])),_:1}),e(A,{type:"danger",size:"small"},{default:t(()=>l[9]||(l[9]=[p(" 禁用 ")])),_:1})]),_:1})]),_:1},8,["data"])),[[G,i(V)]]),e(T,{class:"fr mt mb","current-page":i(_).page,"onUpdate:currentPage":l[2]||(l[2]=a=>i(_).page=a),"page-size":i(_).pageSize,"onUpdate:pageSize":l[3]||(l[3]=a=>i(_).pageSize=a),"page-sizes":[10,20,30,40],layout:"sizes, prev, pager, next, jumper,total",total:i(U),onSizeChange:i(B),onCurrentChange:i(h),background:""},null,8,["current-page","page-size","total","onSizeChange","onCurrentChange"])]),_:1}),e(le,{visible:C.value,"checked-keys":f.value,onClose:l[4]||(l[4]=a=>C.value=!1),account:x.value,btnAuth:u.value,onReload:i(g)},null,8,["visible","checked-keys","account","btnAuth","onReload"])],64)}}});export{se as default};
